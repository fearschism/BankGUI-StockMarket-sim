<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="tailwind.css">
   <link rel="stylesheet" href="css/scrollbar.css">
   <link rel="stylesheet" href="css/ldbtn.min.css"> 
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>StockMarket-v0.0.1-alpha</title>
</head>
<body class="bg-gray-900 select-none">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- Header -->
    <div class="m-6 block">
    <div class="w-full h-28 bg-gray-700 border-green-700 border-l-8 border-b-4 border-solid rounded-md text-center items-center ">
      <div class=" justify-between flex mr-7 ml-7 py-8 text-gray-100">
        <a href="UserHome.html" class="text-4xl hover:text-gray-400">Return</a>
        <a href="StockMarket.html" class="text-4xl hover:text-gray-400">MYstocks</a>
        <a href="#" class="text-4xl hover:text-gray-400 text-gray-400 underline">Market</a>
      </div>
    </div>
    <!-- DashBoard -->
    <div class="flex py-4 ">
      <!-- View dashboard // table -->
      <div class="bg-gray-700 w-8/12 h-96  border-green-700  border-b-4 border-solid rounded-md overflow-auto">
        <table class="table-fixed space-y-2" id="tt">
          <thead>
          <tr class="bg-green-500 border-solid border-gray-600 border-b-8 border-collapse">
            <th class="w-2/12 border-green-800 border-r-2 border-solid">Name</th>
            <th class="w-1/12 border-green-800 border-r-2 border-solid">Symbol</th>
            <th class="w-2/12 border-green-800 border-r-2 border-solid">Price</th>
            <th class="w-1/12 border-green-800 border-r-2 border-solid">Change</th>
            <th class="w-1/12 border-green-800 border-r-2 border-solid">NetChange</th>
            <th class="w-2/12 border-green-800 border-r-2 border-solid">MYshares</th>
            <th class="w-1/12">Buy</th>
          </tr>
        </thead>
        <tbody>
          
          <!-- <tr class="text-center bg-gray-500 hover:bg-gray-300 transition-all ease-in">
            <td class="pb-2 font-semibold" id="Sname">SaadCoin1</td>
            <td class="pb-2">SCC</td>
            <td class="pb-2">50000$</td>
            <td class="pb-2">+20%</td>
            <td class="pb-2">+400.43</td>
            <td class="pb-2">80000000000000</td>
            <td class="pb-2"><button class="bg-red-400 rounded-md w-16 hover:bg-red-500 sell" ><i class="fas fa-dollar-sign"></i></button></td>
          </tr>  -->
  
        </tbody>
        </table>
      </div>
      <!-- Infos and services -->
      <div class="block px-3 space-y-4">
        <div class="w-72 h-32 bg-green-700  border-gray-700 border-b-4 border-solid rounded-md">
          <div class="block space-y-2">
            <div class="grid text-green-900 text-xl bg-green-200 mx-5 rounded-md justify-center">
              <label for="" class="text-center">Balance</label>
              <label for="" class="text-center text-sm font-bold" id="bal">50000 $</label>
            </div>
            <div class="grid text-green-200 text-xl bg-green-900 mx-5 rounded-md justify-center">
              <label for="" class="text-center">E_Balance</label>
              <label for="" class="justify-center text-center text-sm font-bold" id="ebal">5000 $</label>
            </div>
          </div>
        </div>
        <div class="bg-gray-600 w-72 h-60 border-green-700 border-b-4 border-solid rounded-md">
          <!-- Block -->
          <div class="block py-8 space-y-4">
            <!-- checkbox -->
            <div class="flex space-x-3  justify-center"><button class="disabled:bg-green-500 w-20 rounded-md bg-gray-400 disabled:cursor-not-allowed text-sm h-6 hover:bg-gray-200 transition-all ease-in" id="W">Withdraw</button><button class="disabled:bg-green-500 w-20 bg-gray-400 disabled:cursor-not-allowed text-sm rounded-md hover:bg-gray-200 transition-all ease-in" id="D" disabled >Deposit</button></div>
            <!-- INPUT -->
            <div class="grid  space-y-2 m-2"><input type="number" id="in" placeholder="Enter a number" class="h-10 p-2 rounded-md" maxlength="5" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"> <small class="opacity-0 text-red-500 text-xs select-none" id="error">Error messege</small></div>
            <!-- button -->
            <div class="flex  m-10 justify-center"><button class="w-full  bg-green-500 rounded-md hover:bg-green-300 transition-all ease-in" id="ok">OK</button></div>
          </div> 
        </div>
      </div> 
    </div>
    <div class=" w-8/12 flex justify-center"><button class="focus:outline-none bg-green-200 rounded-lg shadow-lg drop-shadow-lg  hover:bg-green-100"><i class="fas fa-angle-double-right text-green-700 text-7xl hover:text-green-500"></i></button></div>
  </div>
  <!-- Starts the storage for the stocks -->
<script src="JS/StockStarter.js"></script> 
<script>
  var thisuser = JSON.parse(localStorage.getItem('logU'))
  console.log(thisuser.E_account.E_balance)
  $('#bal').text(thisuser.balance+" $");$('#ebal').text(thisuser.E_account.E_balance +" $");
</script>
<script>
    var thisuser = JSON.parse(localStorage.getItem('logU'));
   const ss = JSON.parse(localStorage.getItem('stocks'))
   const coin = JSON.parse(localStorage.getItem('coins'))
  for(var i=0;coin.length;i++) {
    var row =  `<tr class="text-center bg-gray-500 hover:bg-green-300 transition-all ease-in">
            <td class="pb-2 font-semibold" id="Sname">${coin[i].name}</td>
            <td class="pb-2">${coin[i].symbol}</td>
            <td class="pb-2" id="price">${coin[i].price}$</td>
            <td class="pb-2">${coin[i].percent_net_change}</td>
            <td class="pb-2">${coin[i].net_change}</td>
            <td class="pb-2" id="sh">${thisuser.E_account.coins[coin[i].name].shares}</td>
            <td class="pb-2"><button class="bg-green-400 rounded-md w-16 hover:bg-green-500 sell" ><i class="fas fa-shopping-cart text-gray-800"></i></button></td>
          </tr>`
    $('tbody').append(row);
        
  }
</script>
<script>
for(var i=0;ss.length;i++) {
    console.log(ss[i].name);
  var row =  `<tr class="text-center hover:bg-green-500 transition-all ease-in text-gray-50">
          <td class="pb-2 font-semibold" id="Sname">${ss[i].name}</td>
          <td class="pb-2">${ss[i].symbol}</td>
          <td class="pb-2" id="price">${ss[i].price}$</td>
          <td class="pb-2">${ss[i].percent_net_change}</td>
          <td class="pb-2">${ss[i].net_change}</td>
          <td class="pb-2" id="sh">${thisuser.E_account.stocks[ss[i].name].shares}</td>
          <td class="pb-2"><button class="bg-gray-800 rounded-md w-16 hover:bg-gray-600 sell" ><i class="fas fa-shopping-cart text-green-400"></i></button></td>
        </tr>`
  $('tbody').append(row);
      
}
</script>

<script>
  var thisuser = JSON.parse(localStorage.getItem('logU'));
  var users = JSON.parse(localStorage.getItem('user'));
  
  var OkW = false;var OkD = true;var okok;
  $('#D').click(function (e) { 
    e.preventDefault();
     OkW = false;$('#D').prop('disabled',true);
      OkD = true;$('#W').prop('disabled',false);
  });
  $('#W').click(function (e) { 
    e.preventDefault();
     OkW = true;$('#D').prop('disabled',false);
      OkD = false;$('#W').prop('disabled',true);
  });
  var index=0;
  for(var i=0;i<users.length;i++){
    if(thisuser.name == users[i].name){index =i};
  }
  $('#ok').click(function (e) { 
    e.preventDefault();
    Check();
    if(okok) {
    if(OkD){thisuser.balance = parseFloat(thisuser.balance)-parseFloat($('#in').val());thisuser.E_account.E_balance=parseFloat(thisuser.E_account.E_balance)+parseFloat($('#in').val());localStorage.setItem('logU',JSON.stringify(thisuser));users[index]=thisuser;localStorage.setItem('user',JSON.stringify(users));window.location.href=''}
    else if(OkW){thisuser.balance = parseFloat(thisuser.balance)+parseFloat($('#in').val());thisuser.E_account.E_balance=parseFloat(thisuser.E_account.E_balance)-parseFloat($('#in').val());localStorage.setItem('logU',JSON.stringify(thisuser));users[index]=thisuser;localStorage.setItem('user',JSON.stringify(users));window.location.href=''}
    }
  });
  function Check() {
    var notempty = true; var notnegative=true;var funds1=true;var funds2=true;okok=false
    if($('#in').val()==null||$('#in').val()==""){notempty=false;$('#error').removeClass('opacity-0');$('#error').addClass('opacity-1');$('#error').text("Please Enter a number");}
    if(parseFloat($('#in').val())>60000||parseFloat($('#in').val())<=0){notnegative=false;$('#error').removeClass('opacity-0');$('#error').addClass('opacity-1');$('#error').text("Limit is 60,000$ and must be positive");}
    if(parseFloat(thisuser.balance)<parseFloat($('#in').val()) &&OkD){funds1=false;$('#error').removeClass('opacity-0');$('#error').addClass('opacity-1');$('#error').text("Balance: "+thisuser.balance+" $");}
    if(parseFloat(thisuser.E_account.E_balance)<parseFloat($('#in').val()) &&OkW){funds2=false;$('#error').removeClass('opacity-0');$('#error').addClass('opacity-1');$('#error').text("E_Balance: "+thisuser.E_account.E_balance+" $");}
    if(notempty&&notnegative&&funds1&&funds2){okok=true;$('#error').removeClass('opacity-1');$('#error').addClass('opacity-0');console.log('okok')}
  }
</script>

<script>
$(document).on('click','.sell', function(){
    let tempstock ={
        name:$(this).closest('tr').find('#Sname').html(),
        price:parseFloat($(this).closest('tr').find('#price').html()),
        shares:parseFloat($(this).closest('tr').find('#sh').html())
    }
    localStorage.setItem('temp',JSON.stringify(tempstock));
    window.location.href ='buyingPage.html';
})


</script>
</body>
</html>